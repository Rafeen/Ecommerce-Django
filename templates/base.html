{% load static %}
<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    {% include 'base/css.html' %}

    <title>{{title}}</title>
</head>
<body>
    {% include 'navbar.html' %}
    <div class="container">

    {% block content %}
    {% endblock %}

    </div>
    <!--  JavaScript -->
    {% include 'base/js.html' %}
    <script>
        $(document).ready(function(){
            var productForm = $(".form-product-ajax")

            productForm.submit(function (event) {
                event.preventDefault();
                var thisForm = $(this);
                var actionEndpoint = thisForm.attr("action");
                var httpMethod = thisForm.attr("method");
                var formData = thisForm.serialize();

                $.ajax({
                    url: actionEndpoint,
                    method: httpMethod,
                    data: formData,
                    success: function(data){
                        console.log('success');
                        console.log(data);
                        var submitSpan = thisForm.find('.submit-span');

                        if (data.added){
                            submitSpan.html("In Cart<button class=\"btn btn-danger\" type=\"submit\">Remove?</button>\n")
                        } else{
                            submitSpan.html("<button class=\"btn btn-success\" type=\"submit\">Add to Cart</button>")
                        }
                        var navBarCartCount = $(".navbar-cart-count");
                        navBarCartCount.text(data.count);

                        var currentPath = window.location.href
                        if(currentPath.indexOf("cart") != 1){
                            updateCart()
                        }
                    },
                    error: function (errorData) {
                        console.log("error");
                        console.log(errorData);
                    }
                })
            })
            function updateCart() {
                var cartTable = $(".cart-table")
                var cartTableBody = $(".cart-table-body")
            }
        })
    </script>
</body>
</html>